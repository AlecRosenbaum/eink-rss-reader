{% extends "base.html" %}

{% block title %}Home - E-Ink Reader{% endblock %}

{% block header_controls %}
<form method="post" action="/feeds/refresh" style="display:inline;margin:0">
    <button type="submit" class="nav-btn nav-icon" title="Refresh">&#x21bb;</button>
</form>
{% if request.query_params.get('filter') %}
<a href="/?page={{ page }}{% if current_label %}&label={{ current_label }}{% endif %}{% if show_read %}&show_read=true{% endif %}" class="nav-btn nav-icon active" title="Hide filter">&#x25b2;</a>
{% else %}
<a href="?filter=1{% if current_label %}&label={{ current_label }}{% endif %}{% if show_read %}&show_read=true{% endif %}" class="nav-btn nav-icon" title="Show filter">&#x25bc;</a>
{% endif %}
{% endblock %}

{% block content %}
{% if request.query_params.get('filter') %}
<form method="get" action="/" class="filter-bar">
    <select name="label" onchange="this.form.submit()">
        <option value="">All labels</option>
        {% for l in labels %}
        <option value="{{ l }}" {% if l == current_label %}selected{% endif %}>{{ l }}</option>
        {% endfor %}
    </select>
    <label class="hide-read-opt">
        <input type="checkbox" name="show_read" value="true"
               {% if show_read %}checked{% endif %}
               onchange="this.form.submit()">
        Show read
    </label>
    <input type="hidden" name="filter" value="1">
</form>
{% endif %}

{% if articles.articles %}
<div class="article-list">
    {% for article in articles.articles %}
    <a href="/article/{{ article.id }}?page={{ page }}{% if current_label %}&label={{ current_label }}{% endif %}{% if show_read %}&show_read=true{% endif %}" class="article-card {% if article.is_read %}read{% endif %}">
        <div class="article-title">{{ article.title or "Untitled" }}</div>
        <div class="article-meta">
            {{ article.feed_title or "Unknown feed" }} &middot;
            {{ article.published_at | relative_time }}
        </div>
    </a>
    {% endfor %}
</div>

<table class="pagination"><tr>
    <td class="pagination-prev">
        {% if articles.has_prev %}
        <a href="/?page={{ page - 1 }}{% if current_label %}&label={{ current_label }}{% endif %}{% if show_read %}&show_read=true{% endif %}{% if request.query_params.get('filter') %}&filter=1{% endif %}"
           class="pagination-btn">&larr; Prev</a>
        {% else %}
        <span class="pagination-btn disabled">&larr; Prev</span>
        {% endif %}
    </td>
    <td class="pagination-info">{{ page }} / {{ articles.total_pages }}</td>
    <td class="pagination-next">
        {% if articles.has_next %}
        <a href="/?page={{ page + 1 }}{% if current_label %}&label={{ current_label }}{% endif %}{% if show_read %}&show_read=true{% endif %}{% if request.query_params.get('filter') %}&filter=1{% endif %}"
           class="pagination-btn">Next &rarr;</a>
        {% else %}
        <span class="pagination-btn disabled">Next &rarr;</span>
        {% endif %}
    </td>
</tr></table>
{% else %}
<div class="empty-state">
    <p>No articles yet.</p>
    <p><a href="/feeds">Add some feeds</a> to get started.</p>
</div>
{% endif %}
{% endblock %}
